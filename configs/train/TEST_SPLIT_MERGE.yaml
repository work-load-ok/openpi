# TEST_SPLIT_MERGE Config
# Value head training config for Pika dataset

_target_: TrainConfig
name: TEST_SPLIT_MERGE

# Model configuration
model:
  _target_: Pi0Config_Custom
  pi05: true
  with_value_head: true
  loss_value_weight: 1.0
  loss_value_use_bce: false
  loss_action_weight: 0.0  # No action loss
  p_mask_ego_state: 1.0
  timestep_difference_mode: false
  discrete_state_input: false  # Not using states into prompt
  download_path: /cpfs01/user/baidexiang/test_ckpt/big_vision/paligemma_tokenizer.model

# Data configuration
data:
  _target_: LerobotPikaDataConfig
  repo_id: 
    - /cpfs01/shared/filtered_cut_data/short_sleeve/demo_A_full_process/v2-2/1102_21_234_v2-2_3000_lerobot
    - /cpfs01/shared/filtered_cut_data/short_sleeve/demo_A_full_process/v2-2/1104_20_270_v2-2_3000_lerobot
  assets:
    _target_: AssetsConfig
    assets_dir: /cpfs01/user/baidexiang/test
    asset_id: flatten_fold
  default_prompt: Flatten the cloth.
  # base_config:
  #   _target_: DataConfig
  #   prompt_from_task: true
  # Repack transforms for image/state/action mapping
  repack_transforms:
    _target_: Group
    inputs:
      - _target_: RepackTransform
        structure:
          images:
            top_head: observation.images.top_head
            hand_left: observation.images.hand_left
            hand_right: observation.images.hand_right
          state: observation.state
          actions: action
          frame_index: frame_index
          progress_gt: progress_gt
          stage_progress_gt: stage_progress_gt
          progress: progress  # Required for training, not for inference

# Weight loader - pretrained weights
pytorch_weight_path: /cpfs01/user/baidexiang/test_ckpt/torch_ver/pi05_base/
pytorch_model_class: PI0Pytorch_Custom
# Training hyperparameters
num_train_steps: 100000
keep_period: 10000
save_interval: 10000

# Data loading
num_workers: 1
batch_size: 3  # For 1 GPU, use 128 for 8 GPUs

# Training modes
with_episode_start: false
timestep_difference_mode: false
stage_process_mode: false
skip_norm_stats: true  # No norm stats used

